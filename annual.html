<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>年度板块 - OneYearXZ</title>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind CSS 配置 -->
    <script>
        tailwind.config = {
            darkMode: 'class', // 添加这行启用暗色模式支持
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3B82F6', // 主色调：现代蓝色
                        'dark-bg': '#0F172A',        // 深色背景：深蓝灰
                        'dark-card': '#1E293B',       // 深色卡片：深灰蓝
                        'light-card': '#F8FAFC',      // 亮色卡片：浅灰蓝
                        'secondary-teal': '#14B8A6'  // 辅助色：青绿色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'neon': '0 0 20px rgba(59, 130, 246, 0.7)',
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            /* 为视频控件添加深色模式支持 */
            .video-dark-mode {
                filter: invert(0.8) hue-rotate(180deg);
            }
        }
    </style>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            /* 导航栏玻璃态效果 */
            .glass-nav {
                backdrop-filter: blur(10px);
                background-color: rgba(15, 23, 42, 0.9);
                box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            }
            
            /* 英雄区域背景覆盖 */
            .hero-overlay {
                background: linear-gradient(to top, rgba(15, 23, 42, 0.95) 0%, rgba(15, 23, 42, 0.5) 50%, rgba(15, 23, 42, 0.95) 100%);
            }
            
            /* 卡片基础样式 */
            .card-base {
                @apply bg-dark-card rounded-xl border border-gray-700 shadow-lg transition-all duration-300 hover:shadow-xl hover:border-primary-blue/50;
            }
            
            /* 模态框基础样式 */
            .modal-base {
                @apply fixed inset-0 bg-black/80 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4;
            }
            
            /* 模态框内容基础样式 */
            .modal-content-base {
                @apply bg-dark-card w-full max-w-2xl rounded-t-xl sm:rounded-xl p-4 border-t border-gray-700 sm:border;
            }
        }
    </style>
    
    <!-- 自定义 CSS -->
    <style>
        /* 基础样式 */
        body {
            background-color: #0F172A; /* Dark Blue Gray (Slate-900) */
            color: #E2E8F0; /* Light Slate (Text) */
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        /* 页面主体 - 亮色模式 */
        body.light-mode {
            background-color: #F8FAFC; /* Light Slate (Slate-50) */
            color: #1E293B; /* Dark Slate */
        }
        
        /* 主标题 - 亮色模式 */
        body.light-mode h1.text-gray-200 {
            color: #0F172A; /* Dark Slate */
        }
        
        /* 年份导航按钮 - 亮色模式 */
        body.light-mode button[id^="year-"] {
            background-color: #3B82F6; /* Primary Blue */
            color: white;
        }
        body.light-mode button[id^="year-"]:hover {
            background-color: #2563EB; /* Darker Blue */
        }
        
        /* 导航栏亮色模式 */
        body.light-mode .glass-nav {
            background-color: rgba(255, 255, 255, 0.9); /* White with opacity */
        }
        body.light-mode .glass-nav .text-gray-200 {
            color: #1E293B; /* Dark Slate */
        }
        body.light-mode .glass-nav #theme-toggle {
            color: #64748b; 
            background-color: transparent; 
        }
        body.light-mode .glass-nav #theme-toggle:hover { 
            background-color: #f1f5f9; 
            color: #A755F7; /* Add hover color for better contrast */
        }
        
        /* 卡片样式 - 亮色模式 */
        body.light-mode .card-base {
            background-color: #ffffff; /* Pure white card */
            border: 1px solid #e2e8f0; /* Slate-200 Border */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); /* Soft, light shadow */
        }
        body.light-mode .card-base:hover {
            box-shadow: 0 10px 25px -5px rgba(167, 85, 247, 0.1), 0 4px 6px -2px rgba(167, 85, 247, 0.05);
        }
        
        /* 年度板块亮色模式样式 */
        body.light-mode #travel-record-form label { color: #1e293b; } /* 表单标签颜色 */
        body.light-mode #travel-record-form input[type="text"],
        body.light-mode #travel-record-form input[type="datetime-local"] {
            background-color: #ffffff; /* 输入框背景色 */
            color: #1e293b; /* 输入框文字颜色 */
            border-color: #e2e8f0; /* 输入框边框颜色 */
        }
        body.light-mode #travel-record-form input[type="text"]:focus,
        body.light-mode #travel-record-form input[type="datetime-local"]:focus {
            border-color: #3B82F6; /* 输入框聚焦边框颜色 - Primary Blue */
        }
        body.light-mode #travel-records p.text-gray-400 { color: #64748b; } /* 暂无记录文字颜色 */
        body.light-mode #travel-records h4 { color: #3b82f6; } /* 记录地点文字颜色 */
        body.light-mode #travel-records p.text-gray-400 { color: #64748b; } /* 记录时间文字颜色 */
        
        /* 提交按钮 - 亮色模式 */
        body.light-mode #travel-record-form button[type="submit"] {
            background-color: #14B8A6; /* Secondary Teal */
            color: white;
        }
        body.light-mode #travel-record-form button[type="submit"]:hover {
            background-color: #0D9488; /* Darker Teal */
        }
        
        /* 文件上传按钮 - 亮色模式 */
        body.light-mode #travel-record-form input[type="file"] {
            color: #64748b;
        }
        body.light-mode #travel-record-form input[type="file"]::-webkit-file-upload-button {
            background-color: #3B82F6; /* Primary Blue */
            color: white;
        }
        body.light-mode #travel-record-form input[type="file"]::-webkit-file-upload-button:hover {
            background-color: #2563EB; /* Darker Blue */
        }
        
        /* 页脚 - 亮色模式 */
        body.light-mode footer {
            background-color: #FFFFFF; /* White */
            border-top-color: #e2e8f0; /* Light Border */
            color: #64748b; /* Slate-600 */
        }
    </style>
</head>
<body class="font-sans antialiased">
    <!-- 导航栏 -->
    <header class="glass-nav sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <!-- 图标和标题 -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-primary-blue">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.54 8.44l-4.24-4.24A4 4 0 005 8v8a4 4 0 004 4h4.56l4.24-4.24a4 4 0 000-5.66z" />
                </svg>
                <a href="index.html" class="text-2xl font-extrabold tracking-tight text-gray-200">OneYearXZ</a>
            </div>
            <!-- Menu Toggle Button (Mobile) -->
            <button id="menu-toggle" class="md:hidden p-2 rounded-full text-gray-400 hover:text-primary-blue hover:bg-dark-card transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            <!-- 菜单 -->
            <nav id="mobile-menu" class="hidden md:flex space-x-8 text-sm items-center font-medium text-gray-200">
                <a href="index.html#stay" class="hover:text-primary-blue transition-colors">精选住宿</a>
                <a href="index.html#eat" class="hover:text-primary-blue transition-colors">美食特荐</a>
                <a href="index.html#explore" class="hover:text-primary-blue transition-colors">周边探索</a>
                <a href="annual.html" class="hover:text-primary-blue transition-colors font-bold text-primary-blue">年度板块</a>
                
                <!-- 主题切换按钮 -->
                <button id="theme-toggle" class="p-2 rounded-full text-gray-400 hover:text-primary-blue hover:bg-dark-card transition-all ml-4">
                    <!-- 月亮图标 -->
                    <svg xmlns="http://www.w3.org/2000/svg" id="moon-icon" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M9.52 2.378a.75.75 0 01.583.743c0 .193-.058.384-.171.554C8.445 5.56 7.25 7.915 7.25 10.5c0 3.866 3.134 7 7 7a7.001 7.001 0 005.106-2.433c.18-.179.43-.275.69-.275.485 0 .972.316.972.784a1.75 1.75 0 01-1.75 1.75c-4.45 0-8.25-3.322-8.25-7.75 0-3.308 2.05-6.28 4.97-7.254a.75.75 0 01.744-.171.75.75 0 01.583.743z" clip-rule="evenodd" />
                    </svg>
                    <!-- 太阳图标 -->
                    <svg xmlns="http://www.w3.org/2000/svg" id="sun-icon" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden">
                        <path d="M12 2.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.05 5.344a.75.75 0 00-.53.183l-.84.842a.75.75 0 001.06 1.06l.84-.84a.75.75 0 00-.53-1.245zm10.95 0a.75.75 0 00-.53 1.245l.84.84a.75.75 0 001.06-1.06l-.84-.842a.75.75 0 00-.53-.183zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5zm-8.25 3.75a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5H4.5a.75.75 0 01-.75-.75zM17.25 12a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zM7.05 18.656a.75.75 0 001.06-1.06l-.84-.84a.75.75 0 00-1.06 1.06l.84.84zm10.95 0a.75.75 0 001.06-1.06l-.84-.84a.75.75 0 00-1.06 1.06l.84.84z" />
                    </svg>
                </button>
                <a href="index.html#map" class="bg-primary-blue text-white px-4 py-2 rounded-full text-sm hover:bg-opacity-80 transition-colors shadow-lg">查看地图</a>
            </nav>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu-dropdown" class="md:hidden hidden bg-dark-card border-t border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 space-y-2">
                <a href="index.html#stay" class="block py-3 px-4 hover:text-primary-blue transition-colors">精选住宿</a>
                <a href="index.html#eat" class="block py-3 px-4 hover:text-primary-blue transition-colors">美食特荐</a>
                <a href="index.html#explore" class="block py-3 px-4 hover:text-primary-blue transition-colors">周边探索</a>
                <a href="annual.html" class="block py-3 px-4 hover:text-primary-blue transition-colors">年度板块</a>
                <div class="flex items-center justify-between py-3 px-4">
                    <button id="mobile-theme-toggle" class="p-2 rounded-full text-gray-400 hover:text-primary-blue hover:bg-dark-card transition-all" onclick="toggleTheme()">
                        <!-- 月亮图标 (默认暗色模式显示) -->
                        <svg xmlns="http://www.w3.org/2000/svg" id="mobile-moon-icon" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M9.52 2.378a.75.75 0 01.583.743c0 .193-.058.384-.171.554C8.445 5.56 7.25 7.915 7.25 10.5c0 3.866 3.134 7 7 7a7.001 7.001 0 005.106-2.433c.18-.179.43-.275.69-.275.485 0 .972.316.972.784a1.75 1.75 0 01-1.75 1.75c-4.45 0-8.25-3.322-8.25-7.75 0-3.308 2.05-6.28 4.97-7.254a.75.75 0 01.744-.171.75.75 0 01.583.743z" clip-rule="evenodd" />
                        </svg>
                        <!-- 太阳图标 (亮色模式显示) -->
                        <svg xmlns="http://www.w3.org/2000/svg" id="mobile-sun-icon" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden">
                            <path d="M12 2.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.05 5.344a.75.75 0 00-.53.183l-.84.842a.75.75 0 001.06 1.06l.84-.84a.75.75 0 00-.53-1.245zm10.95 0a.75.75 0 00-.53 1.245l.84.84a.75.75 0 001.06-1.06l-.84-.842a.75.75 0 00-.53-.183zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5zm-8.25 3.75a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5H4.5a.75.75 0 01-.75-.75zM17.25 12a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zM7.05 18.656a.75.75 0 001.06-1.06l-.84-.84a.75.75 0 00-1.06 1.06l.84.84zm10.95 0a.75.75 0 001.06-1.06l-.84-.84a.75.75 0 00-1.06 1.06l.84.84z" />
                        </svg>
                    </button>
                    <a href="index.html#map" class="bg-primary-blue text-white px-4 py-2 rounded-full text-sm hover:bg-opacity-80 transition-colors shadow-lg">查看地图</a>
                </div>
            </div>
        </div>
    </header>

    <!-- 年度板块 -->
    <main class="py-16 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-5xl font-extrabold mb-16 border-l-4 border-primary-blue pl-4 text-gray-200">年度板块</h1>
        
        <!-- 年份导航 -->
        <div class="flex flex-wrap gap-4 mb-12">
            <button id="year-2025" class="px-6 py-3 bg-primary-blue text-white rounded-lg font-medium hover:bg-opacity-80 transition-all shadow-lg">2025</button>
            <!-- 预留其他年份的位置 -->
        </div>
        
        <!-- 2025年内容区域 -->
        <div id="year-content-2025" class="space-y-12">
            <!-- 记录游玩信息表单 -->
            <div class="card-base p-6 rounded-xl">
                <h3 class="text-2xl font-bold mb-6 text-primary-blue">记录游玩信息</h3>
                <form id="travel-record-form" class="space-y-6">
                    <!-- 地点 -->
                    <div>
                        <label for="location" class="block text-sm font-medium text-gray-200 mb-2">地点</label>
                        <input type="text" id="location" name="location" class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-blue" placeholder="输入游玩地点">
                    </div>
                    
                    <!-- 时间 -->
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-200 mb-2">时间</label>
                        <input type="datetime-local" id="date" name="date" class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-blue">
                    </div>
                    
                    <!-- 图片上传 -->
                    <div>
                        <label for="image" class="block text-sm font-medium text-gray-200 mb-2">图片</label>
                        <input type="file" id="image" name="image" accept="image/*" class="w-full text-gray-200 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary-blue file:text-white hover:file:bg-opacity-80 transition-all">
                    </div>
                    
                    <!-- 视频上传 -->
                    <div>
                        <label for="video" class="block text-sm font-medium text-gray-200 mb-2">视频</label>
                        <input type="file" id="video" name="video" accept="video/*" class="w-full text-gray-200 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary-blue file:text-white hover:file:bg-opacity-80 transition-all">
                    </div>
                    
                    <!-- 提交按钮 -->
                    <button type="submit" class="w-full px-6 py-3 bg-secondary-teal text-white rounded-lg font-medium hover:bg-opacity-80 transition-all shadow-lg">保存记录</button>
                </form>
            </div>
            
            <!-- 游玩记录展示区域 -->
            <div class="card-base p-6 rounded-xl">
                <h3 class="text-2xl font-bold mb-6 text-primary-blue">游玩记录</h3>
                <div id="travel-records" class="space-y-6">
                    <!-- 记录将通过JavaScript动态添加 -->
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="mt-24 py-10 text-center text-gray-500 text-sm bg-dark-card border-t border-gray-700 shadow-inner">
        <p>&copy; 2025 oneyearxuzhou @linx</p>
        <p class="mt-2">-lzx wb zzh lzq xcd-</p>
    </footer>

    <!-- JavaScript -->
    <script>
        // 主题切换功能
        function toggleTheme() {
            const body = document.body;
            const moonIcon = document.getElementById('moon-icon');
            const sunIcon = document.getElementById('sun-icon');
            const mobileMoonIcon = document.getElementById('mobile-moon-icon');
            const mobileSunIcon = document.getElementById('mobile-sun-icon');
            
            // 切换主题类
            body.classList.toggle('light-mode');
            const isDarkMode = !body.classList.contains('light-mode');
            
            // 切换桌面端图标显示
            moonIcon.classList.toggle('hidden', !isDarkMode);
            sunIcon.classList.toggle('hidden', isDarkMode);
            
            // 切换移动端图标显示
            mobileMoonIcon.classList.toggle('hidden', !isDarkMode);
            mobileSunIcon.classList.toggle('hidden', isDarkMode);
            
            // 保存主题设置到localStorage
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            
            // 触发主题变更事件
            window.dispatchEvent(new CustomEvent('themeChanged', { detail: { isDarkMode } }));
        }
        
        // 页面加载时初始化主题
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const isLightMode = savedTheme === 'light' || (!savedTheme && window.matchMedia('(prefers-color-scheme: light)').matches);
            const isDarkMode = !isLightMode;
            
            if (isLightMode) {
                document.body.classList.add('light-mode');
            }
            
            // 更新桌面端图标
            document.getElementById('moon-icon').classList.toggle('hidden', !isDarkMode);
            document.getElementById('sun-icon').classList.toggle('hidden', isDarkMode);
            
            // 更新移动端图标
            document.getElementById('mobile-moon-icon').classList.toggle('hidden', !isDarkMode);
            document.getElementById('mobile-sun-icon').classList.toggle('hidden', isDarkMode);
        }
        
        // 移动端菜单切换
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenuDropdown = document.getElementById('mobile-menu-dropdown');
        
        menuToggle.addEventListener('click', () => {
            mobileMenuDropdown.classList.toggle('hidden');
        });
        
        // 点击移动端菜单外部关闭菜单
        document.addEventListener('click', (e) => {
            if (!menuToggle.contains(e.target) && !mobileMenuDropdown.contains(e.target)) {
                mobileMenuDropdown.classList.add('hidden');
            }
        });
        
        // 添加主题切换按钮事件监听器
        const themeToggle = document.getElementById('theme-toggle');
        const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
        
        if (themeToggle) {
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        if (mobileThemeToggle) {
            mobileThemeToggle.addEventListener('click', toggleTheme);
        }
        
        // 年度板块功能
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化主题
            initializeTheme();
            
            // 设置时间输入框默认显示当前时间
            function setDefaultDateTime() {
                const dateTimeInput = document.getElementById('date');
                if (dateTimeInput) {
                    // 创建当前时间
                    const now = new Date();
                    
                    // 格式化日期为YYYY-MM-DD
                    const datePart = now.toISOString().split('T')[0];
                    
                    // 格式化时间为HH:MM
                    const timePart = now.toTimeString().split(' ')[0].substring(0, 5);
                    
                    // 设置输入框值为YYYY-MM-DDTHH:MM
                    dateTimeInput.value = `${datePart}T${timePart}`;
                }
            }
            
            // 执行设置默认时间
            setDefaultDateTime();
            
            // 年份导航点击事件
            // 修改选择器为只匹配按钮元素，避免匹配年份内容区域
            const yearButtons = document.querySelectorAll('button[id^="year-"]');
            yearButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有年份按钮的活跃状态
                    yearButtons.forEach(btn => {
                        btn.classList.remove('bg-primary-blue');
                        btn.classList.add('bg-gray-700');
                    });
                    
                    // 添加当前点击按钮的活跃状态
                    this.classList.remove('bg-gray-700');
                    this.classList.add('bg-primary-blue');
                    
                    // 获取年份
                    const year = this.id.split('-')[1];
                    
                    // 隐藏所有年份内容
                    const yearContents = document.querySelectorAll('[id^="year-content-"]');
                    yearContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // 显示对应年份的内容
                    const currentYearContent = document.getElementById(`year-content-${year}`);
                    if (currentYearContent) {
                        currentYearContent.classList.remove('hidden');
                    }
                });
            });
            
            // 游玩记录表单提交事件
            const travelRecordForm = document.getElementById('travel-record-form');
            const travelRecordsContainer = document.getElementById('travel-records');
            
            // 从后端API加载记录
            function loadTravelRecords() {
                fetch('/api/records')
                    .then(response => response.json())
                    .then(records => {
                        renderTravelRecords(records);
                    })
                    .catch(error => {
                        console.error('加载游玩记录失败:', error);
                        travelRecordsContainer.innerHTML = '<p class="text-red-400 text-center py-8">加载记录失败，请刷新页面重试</p>';
                    });
            }
            
            // 渲染游玩记录
            function renderTravelRecords(records) {
                if (records.length === 0) {
                    travelRecordsContainer.innerHTML = '<p class="text-gray-400 text-center py-8">暂无游玩记录</p>';
                    return;
                }
                
                // 为视频控件添加深色模式支持
                const videoClass = document.body.classList.contains('light-mode') ? '' : 'video-dark-mode';
                
                travelRecordsContainer.innerHTML = records.map((record, index) => {
                    return `
                        <div class="card-base p-4 rounded-lg shadow-md">
                            <div class="flex flex-col md:flex-row md:items-start gap-4">
                                <div class="w-full md:w-1/3">
                                    ${record.image ? `<img src="${record.image}" alt="游玩照片" class="w-full h-40 object-cover rounded-md" loading="lazy">` : ''}
                                    ${record.video ? `<video src="${record.video}" controls class="w-full h-40 object-cover rounded-md mt-2 ${videoClass}"></video>` : ''}
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-xl font-bold text-primary-blue mb-2">${record.location}</h4>
                                    <p class="text-gray-400 mb-4">${formatDateTime(record.date)}</p>
                                    <button onclick="deleteTravelRecord('${record.id}')" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">删除记录</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // 格式化日期时间
            function formatDateTime(dateString) {
                try {
                    const date = new Date(dateString);
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return dateString;
                }
            }
            
            // 删除游玩记录
            function deleteTravelRecord(recordId) {
                if (confirm('确定要删除这条记录吗？')) {
                    fetch(`/api/records/${recordId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadTravelRecords();
                        } else {
                            alert('删除记录失败: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('删除游玩记录失败:', error);
                        alert('删除记录失败，请重试');
                    });
                }
            };
            
            // 自动保存功能
            const autoSaveFields = ['location', 'date'];
            const autoSaveKey = 'travelRecordAutoSave';
            
            // 加载自动保存数据
            function loadAutoSaveData() {
                const savedData = localStorage.getItem(autoSaveKey);
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        autoSaveFields.forEach(field => {
                            if (data[field]) {
                                document.getElementById(field).value = data[field];
                            }
                        });
                    } catch (error) {
                        console.error('加载自动保存数据失败:', error);
                    }
                }
            }
            
            // 保存自动保存数据
            function saveAutoSaveData() {
                const data = {};
                autoSaveFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        data[field] = element.value;
                    }
                });
                localStorage.setItem(autoSaveKey, JSON.stringify(data));
            }
            
            // 添加自动保存事件监听器
            autoSaveFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    element.addEventListener('input', saveAutoSaveData);
                }
            });
            
            // 表单提交事件处理
            travelRecordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 创建FormData对象
                const formData = new FormData();
                formData.append('location', document.getElementById('location').value);
                formData.append('date', document.getElementById('date').value);
                
                // 添加图片文件
                const imageFile = document.getElementById('image').files[0];
                if (imageFile) {
                    formData.append('image', imageFile);
                }
                
                // 添加视频文件
                const videoFile = document.getElementById('video').files[0];
                if (videoFile) {
                    formData.append('video', videoFile);
                }
                
                // 发送到后端API
                fetch('/api/records', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('保存记录失败: ' + data.error);
                    } else {
                        // 重置表单
                        travelRecordForm.reset();
                        
                        // 清除自动保存数据
                        localStorage.removeItem(autoSaveKey);
                        
                        // 重新加载记录
                        loadTravelRecords();
                        
                        alert('记录保存成功！');
                    }
                })
                .catch(error => {
                    console.error('保存游玩记录失败:', error);
                    alert('保存记录失败，请检查网络连接或重试');
                });
            });
            
            // 表单重置时清除自动保存数据
            travelRecordForm.addEventListener('reset', () => {
                localStorage.removeItem(autoSaveKey);
            });
            
            // 加载自动保存数据
            loadAutoSaveData();
            
            // 页面加载时加载记录
            loadTravelRecords();
        });
    </script>
</body>
</html>